# Client Components

클라이언트 컴포넌트는 클라이언트 요청 시에 렌더되는 상호작용이 가능한 UI를 작성할 수 있도록 해준다.
넥스트에서, 클라이언트 렌더링은 선택이다. 즉 명시적으로 리액트에 어떤 컴포넌트가 클라이언트에서 렌더될지 결정해야한다.

---

## Benefits of Client Rendering

렌더링이 클라이언트에서 일어나는 것에 몇 가지 이점이 있다:

- 상호작응: 클라이언트 컴포넌트는 상태, 이펙트 그리고 이벤트 리스너를 사용할 수 있다. 그러므로, 유저에 즉각적인 피드백을 줄 수 있으며, UI를 변경할 수 있다.
- 브라우저 api: 클라이언트 컴포넌트는 로컬 스토리지 또는 지오로케이션과 같은 브라우저 api에 접근할 수 있어, 특정 UI를 만들 수 있게 해준다.

---

## Using Client Components in Next.js

클라이언트 컴포넌트를 사용하기 위해선, 리액트의 `use client` 명령어를 최상단에 추가해 사용할 수 있다.

`use client`는 서버와 클라이언트 컴포넌트 모듈의 바운더리를 선언하는데 사용된다. `use client`이 파일에 정의되었다는 것은, 그 파일 내부의 자식 컴포넌트를 포함한 모든 모듈들이 클라이언트 번들로 간주되며 - 리액트에 의해 클라이언트에서 렌더된다.

```jsx
"use client";

import { useState } from "react";

export default function Counter() {
  const [count, setCount] = useState(0);

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  );
}
```

아래의 다이어그램은 중첩된 컴포넌트를 보여주는데, `onClick`과 `useState`를 토글.js에서 `use client` 없이 사용할 경우 에러를 유발한다. 이것은 기본적으로, 이런 api가 제공되지 않는 서버에서 렌더되기 때문이다. `use client`를 토글.js에 정의하면, api 사용이 가능한 클라이언트에 컴포넌트와 자식 컴포넌트를 렌더한다.

![](https://nextjs.org/_next/image?url%253D%252Fdocs%252Fdark%252Fuse-client-directive.png%2526w%253D3840%2526q%253D75%2526dpl%253Ddpl_GGqC9f3YC9X7o2mZgeZfBtLubEXa)

> 여러 엔트리 포인트에 `use client` 정의
> 리액트 컴포넌트 트리의 여러 엔트리 포인트에 "use client"를 정의할 수 있다. 이것은 앱을 여러 클라이언트 번들로 나누어준다.
>
> 하지만, `use client`가 클라이언트에서 렌더되는 모든 컴포넌트에서 정의될 필요없다. 바운더리를 우선 설정했다면, 불러와진 모든 자식 컴포넌트 그리고 모듈들은 클라이언트 번들로 간주된다.

---

## How are Client Components Rendered?

첫 페이지 로드를 최적화하기 위해, 넥스트는 리액트의 api를 사용해 클라이언트와 서버 둘다에 정적 html 프리뷰를 렌더한다. 이것은, 유저가 애플리케이션에 첫 방문 했을 때, 유저가 클라이언트 컴포넌트의 자바스크립트 번들이 다운, 파싱 그리고 실행을 기다릴 필요가 없다는 뜻이다.

서버에서:

1. 리액트는 서버 컴포넌트를 특별한 데이터 포맷인 RSC 페이로드로 렌더한다. 클라이언트 컴포넌트의 참조를 포함하는
2. 넥스트는 RSC 페이로드와 클라이언트 컴포넌트 자바스크립트를 사용해 서버에서 라우트를 위한 HTML을 렌더한다.

그 후, 클라이언트에서:

1. HTML은 즉시 상호작용이 없는 라우트의 프리뷰로 보여진다.
2. 리액트 서버 컴포넌트 페이로드는 클라이언트와 서버 컴포넌트 트리의 재조정을 위해 사용되고, 돔을 변경한다.
3. 자바스크립트는 클라이언트 컴포넌트의 UI 상호작용을 하도록 하이드레이트된다.

> 하이드레이션이란?
> 하이드레이션은 이벤트 리스너를 돔에 부착하는 과정으로, HTML이 상호작용 가능하게 한다. 하이드레이션은 `hydrateRoot` 리액트 api를 사용해 동작한다.

### Subsequent Navigations

후속 이동에서, 클라이언트 컴포넌트는 서버에서 렌더된 HTML 없이 클라이언트에서 렌더된다.

즉, 클라이언트 자바스크립트 번들은 다운되고 파싱된다. 번들이 준비되면, 리액트는 RSC 페이로드를 통해 클라이언트와 서버 컴포넌트 트리를 재조정하고 돔을 변경한다.

---

## Going back to the Server Environment

`"use client"`를 선언한 후, 서버 환경으로 돌아가고 싶을 수 있다. 예를 들어, 클라이언트 번들 사이즈를 줄이거나, 서버에서 데이터를 페치, 또는 서버에서만 사용 가능한 api를 사용할 경우.

이론적으로 서버 컴포넌트 내부에 중첩되었더라도 클라이언트와 서버 컴포넌트 그리고 서버 액션을 통해 코드를 서버에 둘 수 있다.
